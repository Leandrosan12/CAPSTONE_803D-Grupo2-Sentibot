{% extends "base.html" %}
{% load static %}

{% block title %}Emociones Interactivas{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  /* ğŸ¨ Fondo y estilo del contenedor del slider */
  #sliderContainer {
    background: linear-gradient(145deg, #f9fbff, #eef3fa);
    border-radius: 20px;
    box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
    padding: 40px 20px;
    width: 60%;
    margin: 0 auto;
    transition: all 0.4s ease;
  }

  /* âš« Barra del slider completamente negra */
  input[type="range"] {
    -webkit-appearance: none;
    width: 80%;
    height: 8px;
    border-radius: 10px;
    background: #000000; /* color base negro */
    outline: none;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  /* Barra (track) negra visible */
  input[type="range"]::-webkit-slider-runnable-track {
    height: 8px;
    background: #000000;
    border-radius: 10px;
  }

  input[type="range"]::-moz-range-track {
    height: 8px;
    background: #000000;
    border-radius: 10px;
  }

  /* Thumb (botÃ³n) moderno azul */
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #007bff, #004aad);
    box-shadow: 0 0 12px rgba(0, 123, 255, 0.6);
    margin-top: -7px;
    transition: all 0.3s ease;
  }

  input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
  }

  input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #007bff, #004aad);
    border: none;
    box-shadow: 0 0 10px rgba(0, 123, 255, 0.6);
    transition: all 0.3s ease;
  }

  /* ğŸ’¬ Texto elegante */
  #preguntaEmocion, #valorPorcentaje {
    color: #1a2a40;
    font-weight: 600;
  }

  h5.text-light {
    color: #2e4057 !important;
  }

  .btn-success {
    background: linear-gradient(90deg, #007bff, #00c3ff);
    border: none;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .btn-success:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(0, 136, 255, 0.5);
  }
</style>

<div class="container text-center py-5">
  <!-- ğŸ’« TÃ­tulo original conservado -->
  <div class="text-center mb-5">
    <h1 class="fw-bold display-5 mb-2">
      <span style="color: #FFD700;">ğŸ’«</span>
      <span style="background: linear-gradient(90deg, #ffffff, #dbe9ff);
                   -webkit-background-clip: text;
                   -webkit-text-fill-color: transparent;">
        Monitoreo Emocional
      </span>
    </h1>
    <p class="fs-5 fw-semibold fst-italic mt-2"
       style="background: linear-gradient(90deg, #FDD835, #FFB6C1, #82B1FF, #A5D6A7, #FFAB91);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;">
      Analiza y comprende tus emociones con un enfoque inteligente
    </p>
  </div>

  <!-- ğŸ˜„ Botones de emociones -->
  <div class="row g-4 justify-content-center" id="emotionContainer">
    {% for emocion in emociones %}
      <div class="col-6 col-md-4 col-lg-2">
        <button class="btn bg-white shadow-lg w-100 py-4 rounded-4 border-0 d-flex flex-column align-items-center justify-content-center emotion-btn"
                data-emocion="{{ emocion.nombre_emocion }}">
          <div class="fs-1 mb-2">
            {% if emocion.nombre_emocion == "AlegrÃ­a" %}ğŸ˜„
            {% elif emocion.nombre_emocion == "Tristeza" %}ğŸ˜¢
            {% elif emocion.nombre_emocion == "Miedo" %}ğŸ˜¨
            {% elif emocion.nombre_emocion == "Enojo" %}ğŸ˜¡
            {% elif emocion.nombre_emocion == "Neutral" or emocion.nombre_emocion == "neutral" %}ğŸ˜
            {% else %}ğŸ™‚{% endif %}
          </div>
          <span class="fw-semibold text-dark">{{ emocion.nombre_emocion }}</span>
        </button>
      </div>
    {% endfor %}
  </div>

  <!-- ğŸ”¥ Slider negro visible -->
  <div id="sliderContainer" class="mt-5 d-none">
    <form method="post" action="{% url 'registrar_emocion_manual' %}">
      {% csrf_token %}
      <input type="hidden" name="emocion_nombre" id="emocionNombre">

      <h4 id="preguntaEmocion" class="mb-4">Â¿QuÃ© tanto sientes esta emociÃ³n?</h4>

      <input type="range" class="form-range mx-auto" min="0" max="100" value="50"
             id="sliderPorcentaje" name="porcentaje" oninput="actualizarValor(this.value)">

      <h5 class="mt-3">Intensidad: <span id="valorPorcentaje">50%</span></h5>

      <button type="submit" class="btn btn-success mt-4 px-4 rounded-pill fw-semibold">
        Confirmar emociÃ³n âœ…
      </button>
    </form>
  </div>
</div>

<script>
  const preguntas = {
    "AlegrÃ­a": "Â¿QuÃ© tan feliz te sientes?",
    "Tristeza": "Â¿QuÃ© tan triste te sientes?",
    "Miedo": "Â¿QuÃ© tan asustado te sientes?",
    "Enojo": "Â¿QuÃ© tan enojado te sientes?",
    "Neutral": "Â¿QuÃ© tan tranquilo te sientes?"
  };

  document.querySelectorAll('.emotion-btn').forEach(btn => {
    btn.style.transition = 'all 0.3s ease';

    btn.addEventListener('mouseenter', () => {
      btn.classList.add('shadow', 'border', 'border-primary');
      btn.style.transform = 'scale(1.08)';
      btn.style.boxShadow = '0 0 20px rgba(0, 123, 255, 0.4)';
    });

    btn.addEventListener('mouseleave', () => {
      btn.classList.remove('border', 'border-primary');
      btn.style.transform = 'scale(1)';
      btn.style.boxShadow = '0 0 10px rgba(0,0,0,0.15)';
    });

    btn.addEventListener('click', () => {
      const emocion = btn.dataset.emocion;
      const sliderContainer = document.getElementById('sliderContainer');
      const preguntaEmocion = document.getElementById('preguntaEmocion');

      sliderContainer.classList.remove('d-none');
      document.getElementById('emocionNombre').value = emocion;
      preguntaEmocion.innerText = preguntas[emocion] || "Â¿QuÃ© tanto sientes esta emociÃ³n?";
      sliderContainer.scrollIntoView({ behavior: 'smooth' });
    });
  });

  function actualizarValor(valor) {
    document.getElementById('valorPorcentaje').innerText = valor + "%";
  }
</script>
{% endblock %}
