{% extends 'base.html' %}
{% load static %}

{% block title %}ğŸ“„ Detalle del Alumno{% endblock %}

{% block content %}
<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- ğŸ”™ BOTÃ“N VOLVER -->
<div class="container mt-3">
  <a href="{% url 'modulo' %}" class="btn btn-outline-light">
    â† Volver
  </a>
</div>

<div class="card text-white bg-dark mb-4 mt-3">
  <div class="card-body d-flex justify-content-between align-items-center">

    <!-- InformaciÃ³n del Alumno -->
    <div class="d-flex align-items-center">
      <img src="{% static 'icon/avatar.png' %}" alt="Avatar"
           class="rounded-circle border border-white me-3"
           style="width:80px; height:80px;">
      <div>
        <h2 class="h4 mb-1">{{ alumno.first_name }} {{ alumno.last_name }}</h2>
        <p class="mb-1"><strong>Sede:</strong> {{ alumno.escuela.nombre|default:"Sin sede" }}</p>
        <p class="mb-1"><strong>Correo:</strong> {{ alumno.email }}</p>
        <p class="mb-1"><strong>Rut:</strong> {{ alumno.rut|default:"Sin rut" }}</p>
        <p class="mb-0"><strong>Rol:</strong> {{ alumno.rol.nombre|default:"Sin rol" }}</p>
      </div>
    </div>

    <!-- Botones funcionales -->
    <div class="d-flex flex-column gap-2">
      <button id="btnEditar" class="btn btn-success" data-alumno-id="{{ alumno.id }}">Editar</button>
      <button id="btnHistorial" class="btn btn-primary">Historial</button>
    </div>

  </div>
</div>

<!-- Datos ocultos del alumno -->
<div id="alumnoInfo"
     data-alumno-id="{{ alumno.id }}"
     data-nombre="{{ alumno.first_name }} {{ alumno.last_name }}"
     data-escuela="{{ alumno.escuela.nombre|default:'Sin sede' }}"
     data-email="{{ alumno.email }}"
     data-rut="{{ alumno.rut|default:'Sin rut' }}"
     data-rol="{{ alumno.rol.nombre|default:'Sin rol' }}"
     style="display:none;">
</div>

<!-- Contenedor dinÃ¡mico del historial -->
<div id="historialContainer" class="mt-4" style="display:none;">
  <div class="card shadow-lg border-0">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="card-title text-success">ğŸ“Š Informe de Emociones y Actividades</h4>
        <button id="btnCerrarHistorial" class="btn btn-secondary btn-sm">âœ– Cerrar</button>
      </div>

      <!-- Resumen de emociones -->
      <div id="resumenEmociones" class="text-center mb-4"></div>

      <!-- GrÃ¡fico dinÃ¡mico -->
      <div id="graficoEmociones" class="d-flex justify-content-center mb-4">
        <canvas id="chartEmociones"
                width="220"
                height="220"
                data-emociones='{{ emociones_json|safe }}'></canvas>
      </div>

      <!-- Actividades del alumno -->
      <div id="actividadesContainer">
        <h5 class="text-secondary mb-3">Actividades relacionadas:</h5>
        <ul id="listaActividades"
            class="list-group"
            data-actividades='{{ actividades_json|safe }}'></ul>
      </div>

      <!-- BotÃ³n para descargar PDF -->
      <div class="text-center mt-4">
        <button id="btnDescargarPDF" class="btn btn-danger">
          ğŸ“¥ Descargar Informe PDF
        </button>
      </div>
    </div>
  </div>
</div>

<!-- LibrerÃ­as necesarias -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="{% static 'js/detalle_alumno.js' %}"></script>
{% endblock %}
